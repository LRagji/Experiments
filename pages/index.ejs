<!doctype html>
<html lang="en">

<head>
    <link rel="stylesheet" href="../static/resources/styles/owl.carousel.min.css">
    <link rel="stylesheet" href="../static/resources/styles/owl.theme.default.min.css">
    <% include ./head %>

    <title>Health Mall</title>
</head>

<body class="bg-light">
    <!-- Main Nav -->
    <% include ./header %>

    <!-- Site Content -->
    <div class="container-fluid" id="mainContainer">
        <!-- Carousel -->
        <div id="banners" class="myshadow carousel slide" data-ride="carousel">
            <ol class="carousel-indicators">
                <li data-target="#banners" data-slide-to="0" class="active"></li>
                <li data-target="#banners" data-slide-to="1"></li>
                <li data-target="#banners" data-slide-to="2"></li>
            </ol>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img class="d-block w-100" src="./static/resources/images/banners/banner1.jpg" alt="First Banner">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="./static/resources/images/banners/banner2.jpg" alt="Second Banner">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="./static/resources/images/banners/banner3.jpg" alt="Third Banner">
                </div>
            </div>
            <a class="carousel-control-prev" href="#banners" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#banners" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
        <div class="row mt-3">
            <div class="col">
                <!-- RESULTS -->
                <div id="resultContainer" class="d-flex justify-content-center justify-content-md-around flex-wrap"></div>
                <div id="loadingSpinner" class="my-2">
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                            aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                            <span id="loadingMessage">Loading Products</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div class="card myshadow">
                    <div class="card-header"><h4>Best Sellers</h4></div>
                    <div class="card-body">
                        <div class="owl-carousel owl-theme">
                                <% pageData.bestSellers.forEach(function(product){ %>
                                  `Hello ${product.name}`
                                  <% }); %>
                        </div>  
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <% include ./footer %>
    <script src="../static/resources/scripts/owl.carousel.min.js"></script>
    <script src="../../static/resources/scripts/paginatedtemplates.js"></script>
    <script>
        var shoppingBadge = $('#shoppingCart');

        function productTemplate(product) {
            return `<div class="card m-2 myshadow myproductcard">
    <a href="/product?pid=${product.id}" >
    <center>
        <img class="productThumbnail" src="../static/resources/images/products/${product.image}" style="max-width:150px;max-height:170px" alt="Product Image">
    </center>
    </a>
    <div class="card-body bg-light">
   <strong>${product.name}</strong>
        <div class="d-flex justify-content-center align-items-center my-2">
        <h3 class="text-success">
        &#8377;${product.offerprice}
        <small><small class="text-muted"><del>&#8377;${product.price}</del></small></small>
        </h3>
        </div>
        <div class="d-flex justify-content-center align-items-center">
        <small>Ships in ${product.meta.shippingdetail} day(s)</small>
        </div>
        <div class="d-flex justify-content-center align-items-center">
        <button onClick=addProductToSession(${product.id},1) class="btn btn-success my-2 mr-0" type="submit"><i class="fas fa-cart-plus"></i>
                Add to cart</button>
        </div>
    </div>
</div>`;
        }

        function setStatus(pageNo, status) {
            if (status === 3) {
                $("#loadingMessage").text("Failed to load page" + pageNo + ", Please refresh the page and try again.");
            }
            if (status === 2) {
                $("#loadingMessage").text("Loading completed");
                $("#loadingSpinner").hide();
            }
            if (status === 1 || status === 0) {
                $("#loadingMessage").text("Loading more products from page " + pageNo);
            }
        }

        function addProductToSession(productId, quantity) {
            $.post("/v1/cart/products", { productId: productId, quantity: quantity }).always((responseData) => {
                if (responseData !== undefined && responseData.TotalProducts !== undefined && parseInt(responseData.TotalProducts)) {
                    showSucess("Product added to your shopping cart.")
                    shoppingBadge.text(parseInt(responseData.TotalProducts));
                }
                else {
                    showFailure("Failed to add product to cart.");
                }
            });
        }

        //hookUpPagination("/v1/home/products", productTemplate, "resultContainer", setStatus, "loadingSpinner", 0, 10);
        $(document).ready(function () {
            $(".owl-carousel").owlCarousel(
                {
                    margin: 10,
                    loop: true,
                    autoWidth: true,
                    items: 4,
                    nav: true
                }
            );
        });
    </script>
</body>

</html>